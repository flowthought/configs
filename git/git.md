# Git Workflows

## Git 101

+ [Tutorial][1] - A bit too detailed
+ [Visual Guide][2]
+ [No bullshit guide][3]
+ [In the beginning was the command line][4]
+ [Change line ending settings][5]
+ [Pretty Git Log][6]
+ [Ignoring gitignore][7]
+ [Move branch][8]
+ [Rename branch][9]
+ [Submodule merge][10]
+ Find the commit that introduced a bug with [git-bisect][11]
+ [Working with submodules][14]
+ [Remove sensitive][17] [data][19]
+ [Rebase onto][18]
+ [Merge repos][20]
+ [Common pitfalls - oh shit git!][31]
+ [Submodules from the git book][36]
+ [Port changes from one folder to another][37]

Related: To find out hardlinks on windows: fsutil hardlink list <filename>

## Tagging

Annotated tags store a message, user's name, email, etc. Lightweight tags are
simple pointers (like fixed branches) without any extra info

    $ git tag -a v1.0 -m "My first version"     # Annotated tag
    $ git tag v1.0-lw                           # A lightweight tag

Tags need to be pushed explicitly

    $ git push origin v1.0
    $ git push origin --tags  # Push all tags

Fetching

    $ git fetch     # Fetches tags which point to any commits already fetched
    $ git fetch --tags  # Fetch all tags

Checkout

    $ git checkout v1.0   # Checkout tag v1.0

## Scenarios (Git 102)

### Ignore per-user files
There may be a file or set of files that you do not want
git to track. E.g. files generated by text editors, winide solutions, etc.
Usually the .gitignore file in the root of the repo contains exclusions for
common types. But there might be something specific to your workflow or choice
of tools that you want git to ignore but do not want to push to .gitignore. For
these, append your exclusion patterns at the end of .git/info/exclude in the
root of your repository. See https://git-scm.com/docs/gitignore for how to
specify exclusion patterns.

### [Changing a remote's URL][12]

    $ git remote -v                       # This lists the remotes
    $ git remote set-url origin <new-url> # Actually changing the remote

### [Delete local and remote branch][13]

    $ git push origin --delete <branch_name>
    $ git branch -d <branch_name> # Use -D if branch has not been merged locally

E.g. 

    $ git branch -d feature         # Use -D if branch has not been merged locally
    $ git branch -rd origin/feature
    $ git push origin --delete feature

To propagate this change:

    $ git fetch --all --prune

Delete all remote tracking branches (even if they still exist on the server)

    $ git branch -r | xargs git branch -rd

### Test for ancestor commit

    $ git merge-base --is-ancestor $COMMIT_ID HEAD
    $ git branch --contains $COMMIT_ID

### Ad hoc push

Push local branch into non-upstream remote. Works when remote is an ancestor of
local.

    $ git push origin local:remote

### [Rename branch][15]

    git branch -m <new_name>
    git branch --move <old_name> <new_name>
    git checkout <new_name>
    git push origin [--set-upstream] <new_name>
    git push origin --delete <old_name>

Shorthands:

 -  move locally (--move) :
        git branch -m <old_name> <new_name>

 -  push new branch (--set-upstream, optional) :
        git push origin [-u] <new_name>

 -  delete (--delete) :
        git push origin -D <old_name>

Set <currentbranch>'s upstream: $ git branch -u origin/<currentbranch>

Descriptions:

    $ git branch --edit-description topic   # Add description to branch named 'topic':
    $ git config branch.topic.description   # View branch description

### [Reset refs][34]

Normally to move a branch pointer, you checkout branch and run git reset --hard.
If you want to avoid the checkout, you can do:

    $ git branch -f branch-name new-tip-commit

For arbitrary refs:

    $ git update-ref -m "Reset <ref> to new commit" <ref> <commit>

where `<ref>` takes a form similar to refs/heads/branch, etc.


### [Submodule update][16]

 -  With version 1.9 of Git and later, you can even download the submodules simultaneously:

        $ git clone --recursive -j8 git://github.com/foo/bar.git
        $ cd bar

    Simultaneously in this case means: in parallel; that is, -j8
    is an optional performance optimization that fetches up to 8 submodules at a
    time in parallel - see man git-clone.

 -  With version 1.6.5 of Git and later, you can use:

        $ git clone --recursive git://github.com/foo/bar.git
        $ cd bar

 -  For already cloned repos, or older Git versions, just use:

        $ git clone git://github.com/foo/bar.git
        $ cd bar
        $ git submodule update --init --recursive

### Fix accidental adds

    $ git update-index --assume-unchanged <file>
    $ git update-index --no-assume-unchanged <file>

### Config
Show all config values and their originating files

    $ git config --list --show-origin   

Show values specific to file:

    $ git config --list --local     # .git/config
    $ git config --list --global    # ~/.gitconfig
    $ git config --list --system    # /etc/gitconfig (Arch)

Excludes file: .git/info/exclude

### Clean working directory

    $ git clean -n  // Dry run
    $ git clean -f  // Delete files
    $ git clean -fd // Delete dirs
    $ git clean -fx // Remove ignored and non-ignored files
    $ git clean -fX // Remove ignored files

### Advanced Traversal

[Originating branch][21] of a commit
[Branch points][22]


### [Git Bisect][11]

    $ git checkout _sha1_  // Compile, test see if good or bad.
    $ git checkout _sha2_  // Repeat
    $ git bisect start
    $ git bisect _sha1_ good   // For e.g.
    $ git bisect _sha2_ bad    // For e.g.

Git will now find the midpoint and checkout your HEAD there. It will update you
on the number of iterations remaining. Do your testing on the checked out
location and label it similar to above:

    $ git bisect _midpoint_ good   // Or bad

### Garbage Collection

Force garbage collection

    git reflog expire --expire=now --all && git gc --prune=now --aggressive

### Other topics

 - [Git Server][23]
 - [Git Patch][24] [Concise version][25]
 - [Push to multiple urls][26] [another link][31]
 - [Separate git ssh key][27]
 - [Same user/host multiple SSH profiles][28]
 - [BFG Repo Cleaner][29] - Purge unwanted files completely from repo
 - [Git branch status][30]
 - [Test git over SSH][32]
 - [Git blame history][35]

## Script Helpers (Git 103)

Get name of current branch

    $ git rev-parse --symbolic-full-name --abbrev-ref HEAD

Get git root folder

    $ git rev-parse --show-toplevel # Follows symlinks. Returns "~/repos/notes"
    $ git rev-parse --show-cdup     # Returns relative path (../../) to current

## Chromium

Dependent changes:

    $ git new-branch --upstream-current <branch-name>       // On current branch
    $ git new-branch --upstream <base-ref> <branch-name>    // On base-ref


--------------------------------------------------------------------------------

[1]: http://www.vogella.com/tutorials/Git/article.html
[2]: http://marklodato.github.io/visual-git-guide/index-en.html
[3]: http://rogerdudler.github.io/git-guide/
[4]: http://www.cryptonomicon.com/beginning.html
[5]: http://stackoverflow.com/questions/10418975/how-to-change-line-ending-settings
[6]: http://stackoverflow.com/questions/1838873/visualizing-branch-topology-in-git/34467298#34467298
[7]: http://stackoverflow.com/questions/10176875/add-gitignore-to-gitignore
[8]: http://stackoverflow.com/questions/5471174/git-move-branch-pointer-to-different-commit-without-checkout
[9]: https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/
[10]: http://stackoverflow.com/questions/1759587/un-submodule-a-git-submodule
[11]: https://git-scm.com/docs/git-bisect
[12]: https://help.github.com/articles/changing-a-remote-s-url/
[13]: http://stackoverflow.com/questions/2003505/how-to-delete-a-git-branch-both-locally-and-remotely
[14]: https://chrisjean.com/git-submodules-adding-using-removing-and-updating/
[15]: http://stackoverflow.com/questions/36999937/how-to-rename-a-git-branch-locally-and-remotely
[16]: http://stackoverflow.com/questions/3796927/how-to-git-clone-including-submodules
[17]: https://help.github.com/articles/removing-sensitive-data-from-a-repository/
[18]: http://stackoverflow.com/questions/33942588/difference-between-rebase-master-and-rebase-onto-master-from-a-branch-deri
[19]: http://stackoverflow.com/questions/307828/completely-remove-file-from-all-git-repository-commit-history
[20]: https://saintgimp.org/2013/01/22/merging-two-git-repositories-into-one-repository-without-losing-file-history/
[21]: https://stackoverflow.com/questions/2706797/finding-what-branch-a-git-commit-came-from
[22]: https://stackoverflow.com/questions/1527234/finding-a-branch-point-with-git
[23]: https://git-scm.com/book/ar/v1/Git-on-the-Server
[24]: https://www.devroom.io/2009/10/26/how-to-create-and-apply-a-patch-with-git/
[25]: https://stackoverflow.com/questions/5159185/create-a-git-patch-from-the-changes-in-the-current-working-directory
[26]: https://stackoverflow.com/questions/14290113/git-pushing-code-to-two-remotes
[27]: https://stackoverflow.com/questions/7927750/specify-an-ssh-key-for-git-push-for-a-given-domain
[28]: https://gist.github.com/jexchan/2351996
[29]: https://rtyley.github.io/bfg-repo-cleaner/
[30]: https://github.com/bill-auger/git-branch-status/blob/master/git-branch-status
[31]: https://gist.github.com/bjmiller121/f93cd974ff709d2b968f
[32]: https://askubuntu.com/questions/336907/really-verbose-way-to-test-git-connection-over-ssh/
[33]: http://ohshitgit.com/
[34]: https://stackoverflow.com/questions/5471174/move-branch-pointer-to-different-commit-without-checkout
[35]: https://stackoverflow.com/questions/5098256/git-blame-prior-commits
[36]: https://git-scm.com/book/en/v2/Git-Tools-Submodules
[37]: https://blog.soltysiak.it/en/2017/08/how-to-use-git-patch-system-to-apply-changes-into-another-folder-structure/
